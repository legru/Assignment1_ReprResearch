{
    "contents" : "---\ntitle: \"Reproducible Research: Peer Assessment 1\"\noutput: \n  html_document:\n    keep_md: true\n---\n## Loading and preprocessing the data\n\n__*Show any code that is needed to*__\n\n__*Load the data (i.e. read.csv())*__\n\n```{r data_loading, cache=TRUE}\n\n# Location of the data\ndata.dir=\"activity\"\n\n#  data file\ndata.filename= \"activity.csv\"\n\n# path to data\ndata.path= paste(data.dir,data.filename,sep='/')\n\n# read the data\ndata.raw <- read.csv(data.path)\n```\n\nAll the data is stored in the variable `data.raw`.  \n\nA quick inspection\n\n```{r data_inspection}\nnames(data.raw)\nstr(data.raw)\n```\n\n\n__*Process/transform the data (if necessary) into a format suitable for your analysis*__\n\nLoad libraries required for the analysis\n\n```{r libraries,message=FALSE,warning=FALSE}\n# libraries required\nlibrary(ggplot2, warn.conflicts = FALSE, quietly=TRUE)\nlibrary(dplyr, warn.conflicts = FALSE, quietly=TRUE)\nlibrary(chron, warn.conflicts = FALSE, quietly=TRUE)\n# option on how to represent numbers\noptions(scipen=999)\n```\n\nCreate a version of the data that does not contain any NA\n\n```{r Remove_NA}\n# ignore the missing values\ndata.no_na <- na.omit(data.raw)\n```\n\n## *What is mean total number of steps taken per day?*\n\n__*For this part of the assignment, you can ignore the missing values in the dataset.*__\n\n__*1. Calculate the total number of steps taken per day*__\n\n```{r steps_per_day}\n# extract the number of steps per day\ndata.sum.day_steps <- summarise(group_by(data.no_na, date), \n                                sum.steps=sum(steps))\n```\n\n\n__*2. Make a histogram of the total number of steps taken each day*__\n\n```{r histogram}\nqplot(sum.steps,data=data.sum.day_steps,\n      geom=\"histogram\")+\n  # fix labels position\n  theme(panel.background = element_rect(fill = 'white', colour = 'black'))\n```\n\n\n__*3. Calculate and report the mean and median of the total number of steps taken per day*__\n\n```{r mean_median, echo=TRUE}\n# compute the mean\ndata.mean_day_steps <- mean(data.sum.day_steps$sum.steps)\n\n# compute the median\ndata.median_day_steps <- median(data.sum.day_steps$sum.steps)\n````\n\n - the mean daily number of steps is `r data.mean_day_steps`\n - the median daily number of steps is `r data.median_day_steps`\n \n\n## What is the average daily activity pattern?\n\n__*1. Make a time series plot (i.e. `type = \"l\"`) of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)*__\n\n````{r time_series_1, fig.width=10}\n# compute the average number of steps taken, averaged across all days\n# based on the 5-minute interval \ndata.no_na.mean_interval_steps <- summarise(group_by(data.no_na,\n                                                     interval), \n                                            mean.steps= mean(steps))\n# plot the the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)\n\nqplot(interval, mean.steps, data=data.no_na.mean_interval_steps,geom=\"line\")+\n  theme(panel.background = element_rect(fill = 'white', colour = 'black'))\n````\n\n__*2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?*__\n\n````{r max_num_steps}\n# sort the  list \nsort.mean.interval.steps <- arrange(data.no_na.mean_interval_steps,\n                                    desc(mean.steps))\n# extract the first time  instant\ninstant= sort.mean.interval.steps[1,1]\n\n# get the max number of steps\nmax_steps=  sort.mean.interval.steps[1,2]\n````\n\nThe 5-minute interval, on average across all the days in the dataset, that contains the maximum number of steps is `r instant` with `r max_steps`.\n\n\n## Imputing missing values\n\n__*Note that there are a number of days/intervals where there are missing values (coded as NA). The presence of missing days may introduce bias into some calculations or summaries of the data.*__\n\n__*1. Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)*__\n\n````{r count_NA}\n# calculate the number of missing values\ndimNA <- dim(data.raw) - dim(data.no_na)\n# report the value\ndimNA[1]\n````\n\nThe number of total 'NA' is `r dimNA[1]`\n\n__*2. Devise a strategy for filling in all of the missing values in the dataset. The strategy does not need to be sophisticated. For example, you could use the mean/median for that day, or the mean for that 5-minute interval, etc.*__\n\nI address the question by replacing the missing values with the mean value of the same interval across all days\n\n````{r strategy_for_NA}\n# this function replaces the NAs with the estimates\n# if the steps is NA, replace it the instant mean\n# otherwise keep the value\n\nestimate_na_steps <- function(data_row) {\n  steps= data_row[[1]]\n  intervals= as.numeric(data_row[[3]])\n  # check whether the value of steps is NA\n  if (is.na(steps)) {\n    # replace it the instant mean\n    f= filter(data.no_na.mean_interval_steps,interval==intervals)\n    steps=f[[which(colnames(f)==\"mean.steps\")]]\n  } # implicit else:  keep steps the way it is\n  # return the original steps, or its estimate\n  steps\n}\n \n````\n \n\n__*3. Create a new dataset that is equal to the original dataset but with the missing data filled in.*__\n\n````{r replace_NA}\n# apply the function to the raw data read from the file\n#data.estimated <- transform(data.raw,steps=na.fill(steps,interval))\n\ndata.estimated <- data.frame(steps= as.numeric(apply(data.raw,1,estimate_na_steps)),\n                             date= data.raw$date,\n                             interval= data.raw$interval)\n````\n\nThe data with the estimates is stored in `data.estimated`.\n\nVerify that the transformation worked correctly\n\n```{r verify_replace_NA}\n# the dimention of data.estimate is the same of data.raw\ndim(data.estimated)==dim(data.raw)\n# data.estimate has no NA\nsum(is.na(data.estimated))==0\n```\n\n\n__*4. Make a histogram of the total number of steps taken each day and Calculate and report the mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?*__\n\n```{r estimated_mean_median}\n\n# extract the estimated number of steps per day\nest.data.sum.day_steps <- summarise(group_by(data.estimated, date), \n                                    sum.steps=sum(steps))\n\n# compute the mean in the estimated case\nest.mean_day_steps <- mean(est.data.sum.day_steps$sum.steps)\n\n# compute the median in the estimated case\nest.median_day_steps <- median(est.data.sum.day_steps$sum.steps)\n\n# plot histogram\nhistogram= qplot(sum.steps,\n                 data=est.data.sum.day_steps,\n                 geom=\"histogram\")+  \n  theme(panel.background = element_rect(fill = 'white', colour = 'black'))\n# add the median (and the mean that has basically the same value)\nhistogram= histogram + geom_abline(intercept = est.median_day_steps, slope = 0,\n                                   color= \"lightblue\")\n#display\nhistogram\n````\n\nThe histogram above shows shows the estimated number of steps per day, while the light blue line shows the value  of the median (and the mean) daily number of steps.\n\nThe requested mean and median values are below.\n\n - the mean daily number of steps is `r est.mean_day_steps`\n - the median daily number of steps is `r est.median_day_steps`\n\n\n__*Impact of imputing missing data on the estimates of the total daily number of steps*__\n\n`est.mean_day_steps - data.mean_day_steps` = `r est.mean_day_steps - data.mean_day_steps` \n\nand\n\n`est.median_day_steps - data.median_day_steps` = `r est.median_day_steps - data.median_day_steps`\n\nThe means and median do not differ.  Although this is somewhat surprising, in reality it is not because the missing values all concentrated in 8 days (2012-10-01 2012-10-08 2012-11-01 2012-11-04 2012-11-09 2012-11-10 2012-11-14\n2012-11-30) and in these days all values are replaced with the corresponding mean values.  As a consequence it woudl be rather suprising to find a major chance on the means and the median. \n\n## *Are there differences in activity patterns between weekdays and weekends?\n\n__*For this part the weekdays() function may be of some help here. Use the dataset with the filled-in missing values for this part.*__\n\n__*1. Create a new factor variable in the dataset with two levels - \"weekday\" and \"weekend\" indicating whether a given date is a weekday or weekend day.*__\n\n```{r weekend_weekday}\n# define constant labels for week end and week \nweekend.level <- \"weekend\"\nweekday.level <- \"weekday\"\n\n# distinguish week ends from week days.\ndata.estimated.we_wd <- mutate(data.estimated,\n                               we_wd=ifelse(is.weekend(as.Date(date)),\n                                            weekend.level,\n                                            weekday.level))\n# transform the we_wd variable in a factor\n# (strickly speakinng it is not needed, but it seems to be required by the homework)\ndata.estimated.we_wd$we_wd <- as.factor(data.estimated.we_wd$we_wd)\n```\n\n\n__*2. Make a panel plot containing a time series plot (i.e. type = \"l\") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). *__\n\n\n\n````{r plot_weekdays_weekend, fig.width=10}\n# compute the mean steps distinguishing week days and week ends\nmean.interval.steps <- summarise(group_by(data.estimated.we_wd, \n                                          interval, \n                                          we_wd),\n                                 steps.mean = mean(steps))\n\n# make two plots\n\nplot.final <- ggplot(mean.interval.steps,aes(interval,steps.mean))+\n  #using line geometry as required\n  geom_line()+\n  # faceting on weekend/weekday\n  facet_wrap(~we_wd,ncol=1)+\n  theme(panel.background = element_rect(fill = 'white', colour = 'black'))\n\n# plot the graph\nplot.final \n\n````\n\n",
    "created" : 1450593836306.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "1866112179",
    "id" : "75314B5F",
    "lastKnownWriteTime" : 1450593847,
    "path" : "C:/Users/Massimo/OneDrive/Documents/GitHub/Coursera/DataScience/ReproducibleResearch/Assignment1_ReprResearch/PA1_template.Rmd",
    "project_path" : "PA1_template.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_markdown"
}